"use strict";export default class CanvasParticles{animating=!1;constructor(t="canvas",i={}){if("string"!=typeof t)throw new TypeError("selector is not a string");if(this.canvas=document.querySelector(t),!(this.canvas instanceof HTMLCanvasElement))throw new ReferenceError("selector does not point to a HTMLCanvasElement");if(this.ctx=this.canvas.getContext("2d"),this.options={background:i.background??"transparent",framesPerUpdate:Math.max(1,parseInt(i.framesPerUpdate)??1),resetOnResize:!!(i.resetOnResize??1),mouse:{interactionType:+(parseInt(i.mouse?.interactionType)??1),connectDistMult:+(i.mouse?.connectDistMult??2/3),distRatio:+(i.mouse?.distRatio??2/3)},particles:{color:i.particles?.color??"black",ppm:+(i.particles?.ppm??100),max:+(i.particles?.max??500),maxWork:Math.max(0,i.particles?.maxWork??1/0),connectDist:Math.max(1,i.particles?.connectDistance??150),relSpeed:Math.max(0,i.particles?.relSpeed??1),rotationSpeed:Math.max(0,(i.particles?.rotationSpeed??2)/100)},gravity:{repulsive:+(i.gravity?.repulsive??0),pulling:+(i.gravity?.pulling??0),friction:Math.max(0,i.particles?.friction??.8)}},isNaN(this.options.framesPerUpdate)&&(this.options.framesPerUpdate=1),isNaN(this.options.mouse.interactionType)&&(this.options.mouse.interactionType=1),isNaN(this.options.mouse.connectDistMult)&&(this.options.mouse.connectDistMult=2/3),isNaN(this.options.mouse.distRatio)&&(this.options.mouse.distRatio=2/3),isNaN(this.options.particles.ppm)&&(this.options.particles.ppm=100),isNaN(this.options.particles.max)&&(this.options.particles.max=500),isNaN(this.options.particles.maxWork)&&(this.options.particles.maxWork=1/0),isNaN(this.options.particles.connectDist)&&(this.options.particles.connectDist=150),isNaN(this.options.particles.relSpeed)&&(this.options.particles.relSpeed=1),isNaN(this.options.particles.rotationSpeed)&&(this.options.particles.rotationSpeed=.02),isNaN(this.options.gravity.repulsive)&&(this.options.gravity.repulsive=0),isNaN(this.options.gravity.pulling)&&(this.options.gravity.pulling=0),isNaN(this.options.gravity.friction)&&(this.options.gravity.friction=.9),this.options.mouse.connectDist=this.options.particles.connectDist*this.options.mouse.connectDistMult,delete this.options.mouse.connectDistMult,this.ctx.fillStyle=this.options.particles.color,"#"===this.ctx.fillStyle[0])this.options.particles.opacity={value:1,hex:"ff"},this.options.particles.color=this.ctx.fillStyle;else{let t=~~(255*this.ctx.fillStyle.split(",").at(-1).slice(1,-1));this.options.particles.opacity={value:t/255,hex:t.toString(16)},this.ctx.fillStyle=this.ctx.fillStyle.split(",").slice(0,-1).join(",")+", 1)",this.options.particles.color=this.ctx.fillStyle}this.canvas.style.background=this.options.background,this.resizeCanvas(),window.addEventListener("resize",(()=>this.resizeCanvas())),window.addEventListener("mousemove",(t=>{this.animating&&(this.mouseX=t.clientX-this.canvas.offsetLeft+window.scrollX,this.mouseY=t.clientY-this.canvas.offsetTop+window.scrollY)})),window.addEventListener("scroll",(t=>{this.animating&&(this.mouseX=t.clientX-this.canvas.offsetLeft+window.scrollX,this.mouseY=t.clientY-this.canvas.offsetTop+window.scrollY)}))}resizeCanvas=()=>{this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.mouseX=1/0,this.mouseY=1/0,this.updateCount=1/0,this.width=this.canvas.width+2*this.options.particles.connectDist,this.height=this.canvas.height+2*this.options.particles.connectDist,this.offX=(this.canvas.width-this.width)/2,this.offY=(this.canvas.height-this.height)/2;const t=Math.floor(this.options.particles.ppm*this.width*this.height/1e6);this.len=Math.min(this.options.particles.max,t),this.options.resetOnResize||void 0===this.particles?this.newParticles():this.matchParticlesAmount()};newParticles=()=>{if(this.len===1/0)throw new RangeError("cannot create an infinite amount of particles");this.particles=[];for(let t=0;t<this.len;t++)this.createParticle()};matchParticlesAmount=()=>{if(this.len===1/0)throw new RangeError("cannot create an infinite amount of particles");for(this.particles=this.particles.slice(0,this.len);this.len>this.particles.length;)this.createParticle()};createParticle=function(t,i,s,o,e){this.particles.push({posX:t-this.offX||Math.random()*this.width,posY:i-this.offY||Math.random()*this.height,x:t,y:i,velX:0,velY:0,offX:0,offY:0,dir:s||2*Math.random()*Math.PI,speed:o||(.5+.5*Math.random())*this.options.particles.relSpeed,size:e||.5+Math.random()**5*2});let a=this.particles.at(-1);a.isVisible=this.isVisible(a)};update=()=>{if(0!==this.options.gravity.repulsive||0!==this.options.gravity.pulling)for(let t=0;t<this.len;t++)for(let i=t+1;i<this.len;i++){const s=this.particles[t],o=this.particles[i],e=Math.hypot(s.posX-o.posX,s.posY-o.posY),a=Math.atan2(o.posY-s.posY,o.posX-s.posX);if(e<this.options.particles.connectDist/2){const t=(1/Math.max(e,10))**1.8*this.options.particles.connectDist*this.options.gravity.repulsive,i=Math.cos(a)*t,n=Math.sin(a)*t;s.velX-=i,s.velY-=n,o.velX+=i,o.velY+=n}else if(0!==this.options.gravity.pulling){const t=(1/Math.max(e,10))**1.8*this.options.particles.connectDist*this.options.gravity.pulling,i=Math.cos(a)*t,n=Math.sin(a)*t;s.velX+=i,s.velY+=n,o.velX-=i,o.velY-=n}}for(let t of this.particles){t.dir=(t.dir+Math.random()*this.options.particles.rotationSpeed*2-this.options.particles.rotationSpeed)%(2*Math.PI),t.velX*=this.options.gravity.friction,t.velY*=this.options.gravity.friction,t.posX=(t.posX+t.velX+Math.sin(t.dir)*t.speed%this.width+this.width)%this.width,t.posY=(t.posY+t.velY+Math.cos(t.dir)*t.speed%this.height+this.height)%this.height;const i=t.posX+this.offX-this.mouseX,s=t.posY+this.offY-this.mouseY;if(0!==this.options.mouse.interactionType){const o=this.options.mouse.connectDist/Math.hypot(i,s);this.options.mouse.distRatio<o?(t.offX+=(o*i-i-t.offX)/4,t.offY+=(o*s-s-t.offY)/4):(t.offX-=t.offX/4,t.offY-=t.offY/4)}t.x=t.posX+t.offX+this.offX,t.y=t.posY+t.offY+this.offY,2===this.options.mouse.interactionType&&(t.posX=t.x-this.offX,t.posY=t.y-this.offY),t.isVisible=this.isVisible(t)}};isVisible=function(t){return!(t.posX<Math.abs(this.offX)||t.posX>this.width-Math.abs(this.offX)||t.posY<Math.abs(this.offY)||t.posY>this.height-Math.abs(this.offY))};render=()=>{this.canvas.width=this.canvas.width,this.ctx.fillStyle=this.options.particles.color+this.options.particles.opacity.hex,this.ctx.lineWidth=1;for(let t of this.particles)t.isVisible&&(t.size>1?(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath()):this.ctx.fillRect(t.x-t.size,t.y-t.size,2*t.size,2*t.size));const t=this.options.particles.connectDist>=Math.min(this.width,this.height),i=this.options.particles.connectDist*this.options.particles.maxWork,s=i*this.len;let o=0;for(let e=0;e<this.len;e++){let a=0;for(let n=e+1;n<this.len;n++){const h=this.particles[e],c=this.particles[n];if(h.isVisible||c.isVisible||t){const t=Math.hypot(h.x-c.x,h.y-c.y);if(t<this.options.particles.connectDist){if(t>=this.options.particles.connectDist/2){let i=Math.floor(255*Math.min(this.options.particles.connectDist/t-1,1)*this.options.particles.opacity.value).toString(16);this.ctx.strokeStyle=this.options.particles.color+(2===i.length?i:"0"+i)}else this.ctx.strokeStyle=this.options.particles.color+this.options.particles.opacity.hex;if(this.ctx.beginPath(),this.ctx.moveTo(h.x,h.y),this.ctx.lineTo(c.x,c.y),this.ctx.stroke(),(o+=t)>=s||(a+=t)>=i)break}}}if(o>=s)break}};animation=()=>{this.animating&&(requestAnimationFrame((()=>this.animation())),++this.updateCount>=this.options.framesPerUpdate&&(this.updateCount=0,window.innerWidth>960&&(this.update(),this.render())))};start=()=>{this.animating||(this.animating=!0,requestAnimationFrame((()=>this.animation())))};stop=()=>{this.animating=!1,this.canvas.width=this.canvas.width}}